---
- hosts: all
  remote_user: root
  become: true
  vars:
    virtual_path: "{{ lookup('env', 'VIRTUAL_PATH') }}"
    proto: "{{ lookup('env', 'PROTO') }}"
  tasks:
    - name: check nginx configs
      ansible.builtin.shell: cat /etc/nginx/conf.d/ds.conf
      register: file_content

    - name: check nginx configs
      ansible.builtin.shell: cat /etc/nginx/conf.d/onlyoffice.conf
      register: file_content_two

    - name: "print message" 
      ansible.builtin.debug: 
        msg: "{{ file_content.stdout }}"

    - name: "pring some message" 
      ansible.builtin.debug: 
        msg: "{{ file_content_two.stdout }}" 

    - name: "Get health check status on {{ proto }}://localhost/{{ virtual_path }}/healthcheck/"        
      uri: 
        url: "{{ proto }}://localhost/{{ virtual_path }}/healthcheck/"
        return_content: yes
        validate_certs: no
      register: healthcheck
      failed_when: "'true' not in healthcheck.content"
